<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Modern Analytics Demo Shop</title>
  <link rel="stylesheet" href="css/site.css">
</head>
<body>
  <header class="site-header">
    <div class="container">
      <a class="logo" href="index.html">TestWA</a>
      <nav class="nav">
        <a href="index.html" aria-current="page">Home</a>
        <a href="about.html">About</a>
        <a href="contact.html">Contact</a>
      </nav>
    </div>
  </header>

  <main>
    <section class="hero">
      <div class="container">
        <h1>Shop</h1>
        <p class="lead">A tiny demo shop to show product and analytics events.</p>
      </div>
    </section>

    <div class="container layout">
      <div class="products" id="products"></div>

      <aside class="cart" aria-label="Shopping cart">
        <h2>Cart</h2>
        <ul id="cartItems"></ul>
        <button id="checkoutBtn" class="button">Begin Checkout</button>
      </aside>
    </div>
  </main>

  <footer class="site-footer">
    <div class="container">
      <small>&copy; 2025 TestWA. All rights reserved.</small>
    </div>
  </footer>

  <script>
  window.dataLayer = window.dataLayer || [];
   window.dataLayer.push({
        event: 'page_view',
        page: {
          path: '/home.html',
          title: document.title || 'Home',
          type: 'Home'
        }
      });

  const products = [
    { id: 'p1', name: '5 minutes call', price: 10.0, img: 'image/phone_call.jpeg' },
    { id: 'p2', name: '1 hour call', price: 15.0, img: 'image/phone_call.jpeg' },
    { id: 'p3', name: '2 hour call', price: 20.0, img: 'image/phone_call.jpeg' }
  ];

  const cart = [];

  function renderProducts() {
    const container = document.getElementById('products');
    container.innerHTML = '';
    products.forEach(p => {
      const div = document.createElement('div');
      div.className = 'product';
      div.innerHTML = `<img src='${p.img}' alt='${p.name}'><div><h3>${p.name}</h3><p>Price: $${p.price}</p><button class="button" onclick="addToCart('${p.id}')">Add to Cart</button></div>`;
      container.appendChild(div);

      dataLayer.push({ event: 'viewItem', ecommerce: { items: [{ id: p.id, name: p.name, price: p.price }] } });
    });
  }

  function addToCart(productId) {
    const product = products.find(p => p.id === productId);
    if (!product) return;
    cart.push(product);
    renderCart();

    dataLayer.push({ event: 'addToCart', ecommerce: { items: [{ id: product.id, name: product.name, price: product.price, quantity: 1 }] } });
  }

  function renderCart() {
    const ul = document.getElementById('cartItems');
    ul.innerHTML = '';
    cart.forEach(item => {
      const li = document.createElement('li');
      li.textContent = `${item.name} - $${item.price}`;
      ul.appendChild(li);
    });
  }

  document.getElementById('checkoutBtn').addEventListener('click', () => {
    if (cart.length === 0) { alert('Cart is empty!'); return; }

    dataLayer.push({ event: 'beginCheckout', ecommerce: { items: cart.map(item => ({ id: item.id, name: item.name, price: item.price, quantity: 1 })) } });

    alert('Checkout simulated! Purchase complete.');

    dataLayer.push({ event: 'purchase', ecommerce: { items: cart.map(item => ({ id: item.id, name: item.name, price: item.price, quantity: 1 })), revenue: cart.reduce((sum, i) => sum + i.price, 0) } });

    cart.length = 0;
    renderCart();
  });

  renderProducts();
  </script>
</body>
</html>
